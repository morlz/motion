!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("dom-css"),require("popmotion")):"function"==typeof define&&define.amd?define(["dom-css","popmotion"],o):t["@morlz/motion"]=o(t.css,t.popmotion)}(this,function(t,o){t=t&&t.hasOwnProperty("default")?t.default:t;var n=function(){this.motions={},this.rounds={},this.opened={}};n.prototype.get=function(t){if(!this.has(t))return null;var o=this.motions[t];return{width:o.width/window.innerWidth*100,height:o.height/window.innerHeight*100,x:o.x,y:o.y,r:this.rounds[t]||0,progress:0}},n.prototype.set=function(t,o){this.motions[t]=o},n.prototype.unset=function(t){this.set(t,void 0),this.setRound(t,void 0)},n.prototype.has=function(t){return!!this.motions[t]},n.prototype.setRound=function(t,o){void 0===o&&(o=1),this.rounds[t]=o},n.prototype.open=function(t){this.isOpened(t)||(this.opened[t]=!0)},n.prototype.close=function(t){this.opened[t]=!1},n.prototype.isOpened=function(t){return!!this.opened[t]};var e=new n,i={wrapper:function(t){return{maxWidth:t.width+"vw",maxHeight:t.height+"vh",transform:"translate("+t.x+"px, "+t.y+"px)",transition:"none",opacity:1}},content:function(t){return{borderRadius:100*t.r+"%",transition:"none",overflow:1==t.progress?"auto":"hidden",minWidth:0}},firstChild:function(t){return{width:t.toWidth+"vw",height:t.toHeight+"vh",transition:"all .375s ease-in-out"}},toolbar:function(t){return{opacity:t.progress,transform:"translateY("+(30*t.progress-30)+"%)"}}},r=function(t){return{wrapper:t,content:t.querySelector(".modal-content"),toolbar:t.querySelector(".modal-toolbar")}};function s(o,n,e){o.$motion.progress=e.progress,o.$motion.current=e;var s=r(n),u=s.wrapper,c=s.content,a=s.toolbar;u&&t(u,i.wrapper(e)),c&&t(c,i.content(e)),a&&t(a,i.toolbar(e)),o.$emit("motion:move",e),o.$forceUpdate()}var u=function(t,o){return void 0===o&&(o=30),new Promise(function(n){setTimeout(function(){return t()?n():u(t,o)},o)})};function c(t){return new Promise(function(o){return u(function(){return t._isMounted}).then(o)})}function a(t){return{toWidth:t.width,toHeight:t.height}}function d(t){var o=t.$motion.options;return{duration:o.duration,easing:o.easing}}var h={MotionFrom:{bind:function(t,o,n){var i=o.value;t.addEventListener("click",function(o){return e.set(i,t.getBoundingClientRect())}),o.modifiers.round&&e.setRound(i)}},MotionTo:{bind:function(n,i,r){return new Promise(function(u,h){var p,f,m;return(p=r.context).$motion.options.quasar&&r.componentOptions&&"q-modal"==r.componentOptions.tag&&[!1,void 0].includes(r.componentOptions.propsData.noRouteDismiss)&&console.warn("QModal without noRouteDismiss work wrong"),f=i.value,p.__motionInjected?u():(m=t.get(n,"overflow"),t.set(n,{opacity:0,overflow:"hidden"}),c(p).then(function(i){try{return e.has(f)?(p.$on("motion:show",function(){var i=e.get(f);e.open(f),o.tween(Object.assign({},{from:Object.assign({},i,a(p.$motion.to)),to:Object.assign({},p.$motion.to,a(p.$motion.to))},d(p))).start({update:function(t){return s(p,n,t)},complete:function(o){t.set(n,"overflow",m),p.$emit("motion:showed")}})}),p.$on("motion:hide",function(){var i=e.get(f);null!==i&&(t.set(n,"overflow","hidden"),o.tween(Object.assign({},{from:Object.assign({},p.$motion.to,a(i)),to:Object.assign({},i,a(i))},d(p))).start({update:function(t){return s(p,n,t)},complete:function(o){t.set(n,"overflow",m),e.close(f),p.$emit("motion:hided")}}))}),(r=p,new Promise(function(t,o){return r.__motionInjected=!0,r.$emit("motion:show"),t()})).then(function(t){try{return u()}catch(t){return h(t)}},h)):u(s(p,n,Object.assign({},p.$motion.to,a(p.$motion.to))))}catch(t){return h(t)}var r},h))})}}},p={duration:375,quasar:!1,easing:o.easing.cubicBezier(.4,0,.2,1)};return{install:function(t,o){void 0===o&&(o={});var n=Object.assign({},h);t.prototype.$motion={options:Object.assign({},p,o),progress:0,current:{},to:{width:100,height:100,x:0,y:0,r:0,progress:1}},Object.keys(n).map(function(o){return t.directive(o,n[o])}),t.mixin({beforeRouteUpdate:function(t,o,n){return new Promise(function(t,o){var e=this;return n(),this.__motionInjected?(this.$once("motion:hided",function(){return new Promise(function(t,o){return this.$motion.progress?t():c(this).then(function(n){var e=this;try{return this.$nextTick(function(t){return e.$emit("motion:show")}),t()}catch(t){return o(t)}}.bind(this),o)}.bind(e))}),t()):t()}.bind(this))},beforeRouteLeave:function(t,o,n){if(!this.__motionInjected)return n();this.$once("motion:hided",function(t){return n()}),this.$emit("motion:hide")}})}}});
//# sourceMappingURL=motion.min.umd.js.map
