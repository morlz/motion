!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("dom-css"),require("popmotion")):"function"==typeof define&&define.amd?define(["dom-css","popmotion"],n):t["@morlz/motion"]=n(t.css,t.popmotion)}(this,function(t,n){t=t&&t.hasOwnProperty("default")?t.default:t;var o=function(){this.motions={},this.rounds={},this.opened={}};o.prototype.get=function(t){if(!this.has(t))return null;var n=this.motions[t].getBoundingClientRect();return{width:n.width/window.innerWidth*100,height:n.height/window.innerHeight*100,x:n.x,y:n.y,r:this.rounds[t]||0,progress:0}},o.prototype.set=function(t,n){this.motions[t]=n},o.prototype.has=function(t){return!!this.motions[t]},o.prototype.setRound=function(t,n){void 0===n&&(n=1),this.rounds[t]=n},o.prototype.open=function(t){this.isOpened(t)||(this.opened[t]=!0)},o.prototype.close=function(t){"function"==typeof this.opened[t]&&this.opened[t](),this.opened[t]=!1},o.prototype.isOpened=function(t){return!!this.opened[t]},o.prototype.resolve=function(t){var n=this;return new Promise(function(o){n.isOpened(t)?n.opened[t]=o:o()})};var e=new o,i={wrapper:function(t){return{maxWidth:t.width+"vw",maxHeight:t.height+"vh",transform:"translate("+t.x+"px, "+t.y+"px)",transition:"none",opacity:1}},content:function(t){return{borderRadius:100*t.r+"%",transition:"none",overflow:1==t.progress?"auto":"hidden",minWidth:0}},firstChild:function(t){return{width:t.toWidth+"vw",height:t.toHeight+"vh",transition:"all .375s ease-in-out"}},toolbar:function(t){return{opacity:t.progress,transform:"translateY("+(30*t.progress-30)+"%)"}}},r=function(t){return{wrapper:t,content:t.querySelector(".modal-content"),toolbar:t.querySelector(".modal-toolbar")}};function s(n,o,e){n.$motion.progress=e.progress,n.$motion.current=e;var s=r(o),u=s.wrapper,c=s.content,a=s.toolbar;u&&t(u,i.wrapper(e)),c&&t(c,i.content(e)),a&&t(a,i.toolbar(e)),n.$emit("motion:move",e),n.$forceUpdate()}var u=function(t,n){return void 0===n&&(n=30),new Promise(function(o){setTimeout(function(){return t()?o():u(t,n)},n)})};function c(t){return new Promise(function(n){return u(function(){return t._isMounted}).then(n)})}function a(t){return{toWidth:t.width,toHeight:t.height}}function d(t){var n=t.$motion.options;return{duration:n.duration,easing:n.easing}}var p={MotionFrom:{bind:function(t,n,o){var i=n.value;t.addEventListener("click",function(n){return e.set(i,t)}),n.modifiers.round&&e.setRound(i)}},MotionTo:{bind:function(o,i,r){return new Promise(function(u,p){var h,f,m;return(h=r.context).$motion.options.quasar&&"q-modal"==r.componentOptions.tag&&void 0===r.componentOptions.propsData.noRouteDismiss&&!1===r.componentOptions.propsData.noRouteDismiss&&console.warn("QModal without noRouteDismiss work wrong"),!e.has(f=i.value)||h.__motionInjected?u():(m=t.get(o,"overflow"),t.set(o,{opacity:0,overflow:"hidden"}),c(h).then(function(i){try{return h.$on("motion:show",function(){var i=e.get(f);e.open(f),n.tween(Object.assign({},{from:Object.assign({},i,a(h.$motion.to)),to:Object.assign({},h.$motion.to,a(h.$motion.to))},d(h))).start({update:function(t){return s(h,o,t)},complete:function(n){t.set(o,"overflow",m),h.$emit("motion:showed")}})}),h.$on("motion:hide",function(){var i=e.get(f);null!==i&&(t.set(o,"overflow","hidden"),n.tween(Object.assign({},{from:Object.assign({},h.$motion.to,a(i)),to:Object.assign({},i,a(i))},d(h))).start({update:function(t){return s(h,o,t)},complete:function(n){t.set(o,"overflow",m),e.close(f),h.$emit("motion:hided")}}))}),(r=h,new Promise(function(t,n){return r.__motionInjected=!0,r.$emit("motion:show"),t()})).then(function(t){try{return u()}catch(t){return p(t)}},p)}catch(t){return p(t)}var r},p))})}}},h={duration:375,quasar:!1,easing:n.easing.cubicBezier(.4,0,.2,1)};return{install:function(t,n){void 0===n&&(n={});var o=Object.assign({},p);t.prototype.$motion={options:Object.assign({},h,n),progress:0,current:{},to:{width:100,height:100,x:0,y:0,r:0,progress:1}},Object.keys(o).map(function(n){return t.directive(n,o[n])}),t.mixin({beforeRouteUpdate:function(t,n,o){return new Promise(function(t,n){return this.__motionInjected?e.resolve(name).then(function(e){try{return o(),c(this).then(function(o){var e=this;try{return this.$nextTick(function(t){return e.$emit("motion:show")}),t()}catch(t){return n(t)}}.bind(this),n)}catch(t){return n(t)}}.bind(this),n):t(o())}.bind(this))},beforeRouteLeave:function(t,n,o){this.__motionInjected?(this.$once("motion:hided",function(t){return o()}),this.$emit("motion:hide")):o()}})}}});
//# sourceMappingURL=motion.min.umd.js.map
